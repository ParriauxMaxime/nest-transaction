!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("reflect-metadata"),require("typeorm")):"function"==typeof define&&define.amd?define(["reflect-metadata","typeorm"],r):"object"==typeof exports?exports["nest-transaction"]=r(require("reflect-metadata"),require("typeorm")):e["nest-transaction"]=r(e["reflect-metadata"],e.typeorm)}(this,(function(e,r){return(()=>{"use strict";var t={150:r=>{r.exports=e},375:e=>{e.exports=r}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,o),a.exports}o.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return o.d(r,{a:r}),r},o.d=(e,r)=>{for(var t in r)o.o(r,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},o.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};return(()=>{o.r(a),o.d(a,{Transaction:()=>O}),o(150);var e=o(375);function r(e,r,t,n,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}function t(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var i=e.apply(t,n);function u(e){r(i,o,a,u,c,"next",e)}function c(e){r(i,o,a,u,c,"throw",e)}u(void 0)}))}}function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(Object(t),!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var c="transaction_repository";function s(r){return!!Reflect.getOwnMetadata("design:paramtypes",r.constructor)&&!!Object.values(r).find((r=>r instanceof e.Repository))}function f(e){var r=new e.constructor(...Object.values(e));return Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)),r}function p(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.hasOwnProperty(r.constructor.name))return n;var o=new r.constructor,a={},u=new Proxy(o,a);n[r.constructor.name]=u;var l=Object.entries(r).reduce(((e,r)=>{var[o,a]=r;return n[a.constructor.name]?i(i({},e),{},{[o]:n[a.constructor.name]}):s(a)?i(i({},e),{},{[o]:p(a,t,n)}):i(i({},e),{},{[o]:a})}),{});Object.defineProperties(o,Object.getOwnPropertyDescriptors(l));var[y,v]=Object.entries(o).find((r=>{var[,t]=r;return t instanceof e.Repository}))||[null];if(y){Object.defineProperty(o,"repositoryKey",{value:y,enumerable:!0});var d=f(v);Object.defineProperty(o,c,{value:d,enumerable:!0})}return u}function l(e){var r=Object.entries(e).reduce(((r,t)=>{var[n,o]=t;return s(o)?i(i({},r),{},{[n]:p(o,e,{})}):i(i({},r),{},{[n]:o})}),{});return new e.constructor(...Object.values(r))}function y(e,r){var t=Object.getPrototypeOf(e.value[e.value.repositoryKey]);Object.keys(t).filter((e=>!["query"].includes(e))).forEach((t=>{e.value.transaction_repository[t]=r[t].bind(r,e.value.transaction_repository.target)})),Object.defineProperty(e.value,e.value.repositoryKey,{value:e.value.transaction_repository})}function v(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push(r.constructor.name),Object.entries(r).reduce(((r,n)=>{var[o,a]=n;if(s(a)&&!t.includes(a.constructor.name)){var[i]=Object.entries(a).find((r=>{var[,t]=r;return t instanceof e.Repository}))||[null],u=v(a,t);return i?[...r,{key:o,value:a},...u]:[...r,...u]}return r}),[])}function d(e,r,t,n){return b.apply(this,arguments)}function b(){return b=t((function*(e,r,n,o){var a,i,u=l(e),c=v(u),s=null==c||null===(a=c[0])||void 0===a||null===(i=a.value)||void 0===i?void 0:i.transaction_repository,f=yield s?s.manager.transaction(function(){var e=t((function*(e){return c.forEach((r=>{y(r,e)})),yield n.apply(u,r)}));return function(r){return e.apply(this,arguments)}}()):n.apply(e,r);return f})),b.apply(this,arguments)}function O(){return function(e,r,n){var o=n.value;n.value=t((function*(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return yield d(this,t,o,r)}))}}})(),a})()}));